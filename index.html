
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/test/styles.css">
  <title>Emoji Dingbats | Random dingbat:</title>
</head>



<body>
  <nav>
  <li><h1>Emoji Dingbats</h1></li>
  <ul>
    <li><a href="/dingbats/create">Create a dingbat</a></li>
  </ul>


</nav>



  <div id="options_menu" class="options-menu">
    
    <ul>
      <li>
        Difficulty:
      </li>
      <radio-group>
      <li>
        <input type="radio" id="check_1" name="radio-group" value="easy">
        <label for="check_1" class="easy-label">Easy</label>
      </li>
      <li>
        <input type="radio" id="check_2" name="radio-group" value="medium">
        <label for="check_2" class="medium-label">Medium</label>
      </li>
      <li>
        <input type="radio" id="check_3" name="radio-group" value="hard">
        <label for="check_3" class="hard-label">Hard</label>
      </li>
      <li>
        <input type="radio" id="check_4" name="radio-group" value="evil">
        <label for="check_4" class="evil-label">Evil</label>
      </li>
      </radio-group>
    </ul>
  </div>
  <div class="body content">

  
  <div class='site-title'>Expressions</div>
  

  
    
    <div class='question_box'>üåßÔ∏èüê±üê∂</div>
    <div class='answer_box' id='answer_box'>
      
      
        
        <div name="active-word" class="word-container">
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
        </div>
      
        
          <div class='blank_space' id='blank'></div>
        
        <div name="active-word" class="word-container">
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
        </div>
      
        
          <div class='blank_space' id='blank'></div>
        
        <div name="active-word" class="word-container">
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
        </div>
      
        
          <div class='blank_space' id='blank'></div>
        
        <div name="active-word" class="word-container">
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
          <input class="input-box" type="text" id="text-input" name="input-box" maxlength="1" oninput="this.value = this.value.toUpperCase()" autocomplete="off"/>
        
        </div>
      
      
      
    </div>
    <div id='cluesAndButton' class='clues-and-button'>
      
      
      
      <div class='giveUpBox'>
        
        <button id='giveUp' class='giveUpButton'>Show Answer</button>
      </div>
    </div>

    <div id='answered' class='success-box hidden'>
    <h3 id="congratulations" class='congratulations'>Congratulations!</h3>
    <div id='completionPercentage' class='completionPercentage category-title' ></div><br/>
    <p id='timeScore' class='timeScore'></p><br/>
    <div id='thumbs' class='thumbs'>
      
      <p> Select a rating to move on to the next puzzle.</p>
      <div id='thumbFlex' class='thumb-flex'>
      <div id='thumbs-down' class='thumbs-down'><a href='/dingbats/rate?id=618975c7fae7ac151623b4dd&rating=down'>üëé</a></div>
      <div id='thumbs-up' class='thumbs-up'><a href='/dingbats/rate?id=618975c7fae7ac151623b4dd&rating=up'>üëç</a></div>

      
      </div>
      <div class="share-container"><span>Share link: </span><span class='share-url-container'><input id="shareUrl" class="share-url" value="http://localhost/dingbats/618975c7fae7ac151623b4dd" onclick="this.select(); navigator.clipboard.writeText(this.value);"/></span></div>
    </div>
  </div>

      

  </div>

  <footer>
  Copyright &copy; Blah Blah
</footer>
</body>

</html>

<script>


  let loadTime;
  let answer = 'Raining cats and dogs';
  let wordArray = answer.toUpperCase().split(' ');

  window.onload = () => {
    loadTime = Date.now();
    init();
  }


  function init(clear=false) {

      //Check to see if correct answer
      if (!wordArray.length) {
        puzzleAnsweredCorrectly(Object.values(document.getElementsByName("input-box")), (Date.now() - loadTime)/1000);
        return
      }

  
    if (clear) {
      clearEventListeners()
    } else {
      setRadioButtons();
      updateCompletion(success=false, answered=false)
    }

    let boxes = Object.values(document.getElementsByName("input-box")).filter(word => !word.disabled);
    
    let words = Object.values(document.getElementsByName("active-word")).filter(word => !word.children[0].disabled);

    



    addEventListeners(boxes, words);

    if (!clear) {
      boxes[0].focus();
    } else {
      Object.values(document.getElementsByClassName('focused'))[0].focus();
    }

    }

  function clearEventListeners() {
    let old_element = document.getElementById("answer_box");
    let new_element = old_element.cloneNode(true);
    old_element.parentNode.replaceChild(new_element, old_element);
  }

  function addEventListeners(boxes, words) {

    let boxes_length = boxes.length;

    boxes.forEach((box, i) => {
      box.addEventListener('focus', (event) => {
        box.classList.add('focused');
      })
      box.addEventListener('focusout', (event) => {
        if (!(event.relatedTarget === null) && event.relatedTarget.id === 'text-input') {
          box.classList.remove('focused');
        } else {
          box.focus()
        }
      })
      box.addEventListener('input', (event) => {

        if (box.value === ' ') {
          box.value = '';
        } else {
          boxes[(i+1+boxes_length)%boxes.length].focus();
        }
        //Check to see if correct word
        words.forEach((word, i) => {
          
          wordBoxes = Object.values(word.getElementsByClassName('input-box'));

          let wordAttempt = wordBoxes.reduce(((total, box) => total + box.value),"");
          
          if (!word.answered && (wordAttempt === wordArray[i])) {
            delete wordArray[i]
            wordArray = wordArray.filter(e => e)
            wordAnsweredCorrectly(wordBoxes, word);
            word.answered = true;
          }
        })
      })
      box.addEventListener('keydown', (event) => {
        if (event.key === 'Backspace' && i !== 0) {
          if(box.value) {
            boxes[i].value = "";
          } else if (boxes[(i-1+boxes_length)%boxes.length]) {
            boxes[(i-1+boxes_length)%boxes.length].value = "";
            boxes[(i-1+boxes_length)%boxes.length].focus();
            }
          }
          else if (event.key === 'ArrowRight') {
            boxes[(i+1+boxes_length)%boxes.length].focus();
          }
          else if (event.key === 'ArrowLeft') {
            boxes[(i-1+boxes_length)%boxes.length].focus();
          }

        })
      })
      
      document.getElementById('giveUp').addEventListener('click', () => {
        giveUp(boxes)
      });


  }

  function checkCorrectWord () {

  }

  function checkCorrectAnswer () {

  }

  function wordAnsweredCorrectly(wordBoxes,word) {
    wordBoxes.forEach((box) => {
      
      box.classList.remove('focused');
      box.disabled = true;
      //box.name = 'inactive-box'
      box.classList.add('winner');
    })

    init(true)


  }
  function puzzleAnsweredCorrectly(boxes, time) {
    boxes.forEach((box, i) => {
      box.classList.add('winner');
      box.classList.remove('focused');
      box.disabled = true;
      
    })
    updateSuccess(time);
    updateCompletion(success=true, answered=true);
    initRatingDisplay(true);
  }

  function updateCompletion(success, answered) {
    const completionPercentage = ((39 + (success ? 1 : 0))  / (57 + (answered ? 1 : 0)) * 100) || 0;
    document.getElementById('completionPercentage').innerHTML = `This puzzle has a <b>${Math.floor(completionPercentage)}%</b> completion rate out of <b>${57 + (answered ? 1 : 0)}</b> attempts`
  }

  function giveUp(boxes) {
    updateCompletion(success=false, answered=true);
    boxes.forEach((box, i) => {
      box.value = answer.replace(/ /g, '').toUpperCase()[i]
      box.classList.add('give-up');
      box.classList.remove('focused');
      box.disabled = true;

    })
    const xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/dingbats/failed");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send('id=618975c7fae7ac151623b4dd');
    initRatingDisplay(false);
  }

  function updateSuccess(time) {
    const xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/dingbats/success");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send('id=618975c7fae7ac151623b4dd&time=' + time);
    const averageTime = (Math.round(12.310796844181462 * 100) / 100).toFixed(2);
    const timePercentageDifference = ((averageTime - time) / averageTime) * 100;
    const fasterOrSlower = timePercentageDifference < 0 ? 'slower' : 'faster';
    document.getElementById('timeScore').innerHTML = averageTime > 0 ? `You were <span style='color: ${fasterOrSlower === 'faster' ? 'green' : 'red'}'>${Math.floor(Math.abs(timePercentageDifference).toString())}% ${fasterOrSlower}</span> than the average speed of <b>${averageTime}</b> seconds` : '';
  }

  function initRatingDisplay(success) {
    document.getElementById('answered').classList.remove('hidden');
    if (!success){
      document.getElementById('congratulations').classList.add('hidden');
      document.getElementById('timeScore').classList.add('hidden');
    }
    
    document.getElementById('cluesAndButton').classList.add('hidden');
    
    

  }

  function revealClue() {
    document.getElementById('clueButton').remove();
    document.getElementById('clue').innerHTML = "";
  }

  function setRadioButtons() {
    radios = Object.values(document.getElementsByName('radio-group'));
    difficulty = getCookie('difficulty');
    switch(difficulty) {
      case 'easy':
        radios[0].checked = true;
        break;
      case 'medium':
        radios[1].checked = true;
        break;
      case 'hard':
      radios[2].checked = true;
      break;
      case 'evil':
        radios[3].checked = true;
      break;
      default:
        radios[0].checked = true;
    }
    radios.forEach(radio => {
      console.log(radio)
      radio.addEventListener('change', () => {
        if (radio.checked) {
          setCookie('difficulty', radio.value, 30);
          location.reload();
        }
      })
    })
  }

  function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }
  function setCookie(cname, cvalue, exdays) {
    const d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    let expires = "expires="+ d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  }


</script>
